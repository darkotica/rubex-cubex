# rubex-cubex
Rubex-Cubex is a Rubik's cube detector and solver. Cube's sides are detected by capturing images of the cube from the user's webcam, after which colors and alignments of each side are extracted from captured images using OpenCV library. In case of solving the cube, the programme uses neural network which is initially trained by supervised learning, and retrained using reinforcement learning.

## About the project

### Side detection
Each side of the cube is detected by showing that side of the cube towards the user's webcam. The programme converts the recorded image into HSV format, in order to improve image and color processing. After that, Gaussian blur is applied in order to remove noise from the image. Canny edge detection is applied as well in order to detect edges within the image, from which the contours can be found. These contours are then analyzed, in order to filter out redundant ones and leave only the ones which are square shaped and have other neighbouring squares. After finding all of 9 squares of the side of the cube, color of each squared is determined by finding the most dominant color in that part of the image. All of the image processing is done by OpenCV library.

### Cube solving
- Cube is solved by using neural network to determine how many moves the current cube's state is from being solved. The next move for a given state is determined by choosing the move which leads to the state that has the lowest estimate of moves required to solve, and therefore being the most likely to be the best move (greedy search). 
- Neural network consists of 5 layers (288, 1024, 512, 512, 128 neurons), with ReLU activation function and BatchNormalization between each one of them.
- Network is initially trained by using supervised learning. The dataset is generated by making random moves from the ending state of the cube, and recording how many moves the resulting position is from the original state (for example, after shuffling the solved state of the cube for 3 times, we get a cube state which is labeled to have 3 as a value of distance towards the ending state). 
- After this, the network is trained using approximate value iteration reinforcement learning. This is done by generating a dataset of random states of the cube (identical to the previous one in supervised learning), and assiging a value (heuristics) to each of these states. These values are determined by taking the lowest estimate out of all the possible next states of the cube (we assign value to the state of the cube S(t) by calculating values in S(t+1)). After all of these estimates are made, neural network is trained using this generated dataset.

### Results

- Cube is considered solved if the programme manages to solve it under 30s.

| Num. of moves from solved state | Supervised | Supervised + RL
| ------------- | ------------- | ------------- |
| 9  | 99%  | 99%  |
| 10 | 88%  | 99%  |
| 11 | 74%  | 94%  |
| 12 | 60%  | 90%  |

- For cube's states which are 9 moves or less away from the solved state, both models manage to solve the cube in 99% of the cases.
- In case of cube's states which are more than 12 moves away from the solved state, both models require more than 30s to solve the cube.

## Running the project

### Requirements
All the dependencies listed in the <em>requirements.txt</em> file have to be installed, preferably inside an enviroment created with venv specifically for Rubex-Cubex. <br>

To install the requirements enter the following command in your terminal:
<br>
```console
pip install -r requirements.txt
``` 
The application also requires a working webcam. 

### Using the application

To run the main application start the main.py file inside the face-recognition folder:
```console
python main.py
```
When the application runs the user is promted with a message on how to enter the detected faces of the Rubik's cube in frame. As soon as the application detects a Rubik's cube face it shows a preview of the colors it has read.

<p align="center">
<img src="images/faces.png" width="" height="400">
</p>

If the user is not satisfied with the predefined color values, they can calibrate the colors their colors according to their Rubik's cube. 

<p align="center">
<img src="images/calibration.png" width="" height="400">
</p>

To exit the application use the <em>ESC</em> key. As the application exits it will print out the moves needed to solve the given Rubik's cube.

<p align="center">
<img src="images/results.jpg" width="" height="150">
</p>

## Developers

-   [Dalibor MaliÄ‡](https://github.com/Dado555)
-   [Darko Tica](https://github.com/darkotica)
-   [Zoran Janko](https://github.com/begnoo)
